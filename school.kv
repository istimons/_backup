#:import get_hex_from_color kivy.utils.get_hex_from_color
#:import FadeTransition kivy.uix.screenmanager.FadeTransition

ScreenManager:
    LogInScreen:
    CatalogSearchScreen:
    LibraryDashboardScreen:
    PasswordPhoneUpdateScreen:

<PhoneUpdateDialog>:
    orientation: "vertical"
    spacing: "12dp"
    size_hint_y: None
    height: "35dp"

    MDTextField:
        hint_text: "Phone"


<PasswordUpdateDialog>:
    title: "Update Password"
    size_hint: (0.8, 0.18)

    MDBoxLayout:
        orientation: "vertical"

        TextInput:
            id: update_password
            password: True
            size_hint: (1, 0.01)

        MDGridLayout:
            cols: 2
            rows: 1
            size_hint: (1, 0.01)

            Button:
                size_hint: dp(1), None
                text: "close"
                icon: "update"
                size_hint: (1, 0.01)
                on_press:
                    root.dismiss()

            Button:
                size_hint: dp(1), None
                text: "update"
                size_hint: (1, 0.01)
                on_press:
                    root.get_pass_update()
                    root.dismiss()

<Footer@MDGridLayout>:
    cols: 7
    pos_hint: {'center_x': 0.501, 'center_y': 0}
    size_hint: (0.9, 0.08)

    canvas.before:
        Color:
            rgba: 0, 0, 0, 2
        Line:
            width: 0.5
            rectangle: (self.x, self.y+5, self.width, self.height)
    Label:
        size_hint: 0.0001, 0

    MDRoundFlatIconButton:
        icon: 'home'
        on_press:
            app.switch_to_dashboard_screen()

    Label:
        size_hint: 0.01, 0

    MDRoundFlatIconButton:
        icon: 'book-open-page-variant'
        custom_color: 1, 1, 1, 1

    Label:
        size_hint: None, 0

    MDRoundFlatIconButton:
        icon: 'account'
        on_press:
            app.switch_to_password_screen()


    Label:
        size_hint: 0.0001, 0.01

    Label:
        size_hint: 0, 0.04


<LogInScreen>:
    name: "LogInScreen"
    password_entered: password_entered
    student_id: student_id

    MDBoxLayout:
        orientation: 'vertical'

        FitImage:
            source: 'images/mainLogin.png'

    MDBoxLayout:
        id: box
        orientation: 'vertical'
        size_hint_y: None
        height: self.minimum_height
        padding: "24dp", "24dp", "24dp", "32dp"
        pos_hint: {"center_x": .5, "center_y": .4}
        spacing: "12dp"
        size_hint_x: .75

        canvas:
            Color:
                rgba: 1, 1, 1, .20
            Rectangle:
                pos: self.pos
                size: self.size

        MDTextFieldRound:
            id: student_id
            icon_right: "lock"
            hint_text: "PERSON ID"
            required: True
            color_mode: 'custom'
            line_color_focus: 1, 1, 1, 1
            color: 1, 1, 1, 1

        MDTextFieldRound:
            id: password_entered
            icon_right: "lock"
            hint_text: "Password"
            password: True
            required: True
            input_filter: "float"
            color_mode: 'custom'
            line_color_focus: 1, 1, 1, 1
            color: 1, 1, 1, 1


        MDRaisedButton:
            text: "Log In"
            pos_hint: {"center_x": .5}
            md_bg_color: 0, 1, 1, .5
            on_release: root.get_user_password()

    MDBoxLayout:
        pos_hint: {"center_x": .5, "y": .03}


<SelectableButton>:
    # Draw a bg to indicate selection
    canvas.before:
        Color:
            rgba: (0, 0, 0, 0)
#            rgba: (1, 0, 0, 1) if self.selected else (.0, 0.9, .1, .3)

        Rectangle:
            pos: self.pos
            size: self.size

<CatalogSearchScreen>:

    name: 'CatalogSearchScreen'

    CatalogSearchBoxScreen:

<CatalogSearchBoxScreen>:
    orientation: 'vertical'
    height: "40dp"
    adaptive_height: True

    search_input: search_input

    Label:
        size_hint: 1, 0.05

    MDTextFieldRound:
        id: search_input
        size_hint: 0.7, 0.1
        pos_hint: {'center_x': 0.5, 'center_y': 1}
        icon_right: 'book-search'
        hint_text: 'CATALOG SEARCH'
        text_size: None, None
        halign: "left"
        valign: "middle"
        on_text:
            root.set_items_list(self.text, True)

    MDLabel:
        markup: True
        text: '  Search Results ({})'.format(root.set_items_list(self.text, True))
        size_hint: 1, 0.05
        theme_text_color: "Custom"
        text_color: 1, 0, 0, 1

    RecycleView:
        id: search_results_list
        key_viewclass: 'viewclass'
        key_size: 'height'

        do_scroll_y: True
        do_scroll_x: False

        SelectableRecycleBoxLayout:

            default_size: None, dp(85)
            default_size_hint: 1, None

            size_hint_y: None
            height: self.minimum_height
            orientation: 'vertical'
            spacing: dp(2)
            padding: dp(2)
    MDLabel:
        size_hint: 1, 0.02

    Footer:

<LibraryDashboardScreen>:

    name: 'LibraryDashboardScreen'

    LibraryDashboardBoxScreen:

<LibraryDashboardBoxScreen>:
    orientation: 'vertical'
    height: "40dp"
    adaptive_height: True

    lib_search_input: lib_search_input

    Label:
        size_hint: 1, 0.05

    MDTextFieldRound:
        id: lib_search_input
        size_hint: 0.7, 0.1
        pos_hint: {'center_x': 0.5, 'center_y': 1}
        icon_right: 'book-search'
        hint_text: 'CATALOG SEARCH'
        text_size: None, None
        halign: "left"
        valign: "middle"
        on_text:
            app.root.transition = FadeTransition(duration=0.0000001)
            app.switch_to_catalog_screen()

    MDGridLayout:
        cols: 3
        rows: 2
        padding: 100
        spacing: 50

        pos_hint: {'center_x': 0.501, 'center_y': 0}
        size_hint: (1, 0.9)

        MDGridLayout:
            cols: 2
            rows: 1
#            orientation: 'lr-tb'

            Image:
                source: 'images/borrowedbooks.png'

            Label:
                text: '2'
                size_hint:(0.1, 2)
                color: 1,0,1,1

        MDLabel:
            size_hint_x: 0

        MDGridLayout:
            cols: 2
            rows: 1
#            orientation: 'lr-tb'


            Image:
                source: 'images/group.png'

            Label:
                text: '0'
                size_hint:(0.1, 2)
                color: 1,0,1,1

        MDLabel:
            size_hint_x: 0


        MDGridLayout:
            cols: 2
            rows: 1
#            orientation: 'lr-tb'

            Image:
                source: 'images/booksready.png'
                size_hint_x: 1

            Label:
                text: '3'
                size_hint:(0.1, 2)
                color: 1,0,1,1

        MDLabel:
            size_hint_x: 0


    Footer:


<PasswordPhoneUpdateScreen>:

    name: 'PasswordPhoneUpdateScreen'

    PasswordPhoneBoxUpdate:

<PasswordPhoneBoxUpdate>:
    orientation: 'vertical'

    Label:
        size_hint: 1, 0.05

    MDBoxLayout:
        orientation: 'vertical'
        size_hint_y: 0.4
        pos_hint: {"center_x": .5, "center_y": .4}
        size_hint_x: .95

        canvas:
            Color:
                rgba: 1, 1, 1, 5
            Ellipse:
                pos: 280, 990
                size: 200 , 200
                source: 'avatar.png'
                angle_start: 0
                angle_end: 360

        Label:
            size_hint: 1, 0.09

    MDGridLayout:
        cols: 2
        rows: 5
        padding: 5
        spacing: 0.5

        pos_hint: {'center_x': 0.501, 'center_y': 0}
        size_hint: (0.9, 0.4)


        MDLabel:
            text: 'Name'
            theme_text_color: "Custom"
            text_color: 1, 0, 0, 1


        MDLabel:
            text: 'Vanessa Carlton'
            theme_text_color: "Custom"
            text_color: 0, 0, 0, 1

        MDLabel:
            text: 'Grade'
            theme_text_color: "Custom"
            text_color: 1, 0, 0, 1

        MDLabel:
            text: '9th C'
            theme_text_color: "Custom"
            text_color: 0, 0, 0, 1

        MDLabel:
            text: 'Student ID'
            theme_text_color: "Custom"
            text_color: 1, 0, 0, 1

        MDLabel:
            text: 'IXC2F99'
            theme_text_color: "Custom"
            text_color: 0, 0, 0, 1

        MDLabel:
            text: 'Phone'
            theme_text_color: "Custom"
            text_color: 1, 0, 0, 1

        MDGridLayout:
            cols: 2
            rows: 1
            MDLabel:
                text: '(956)5830045'
                theme_text_color: "Custom"
                text_color: 0, 0, 0, 1
#            MDRoundFlatButton:
#                text: "update"
#                size: (0.4, 0)
#                on_press:
#                    app.show_phone_update_dialog()

        MDLabel:
            text: 'Password'
            theme_text_color: "Custom"
            text_color: 1, 0, 0, 1

        MDGridLayout:
            cols: 2
            rows: 1

            MDLabel:
                text: '*********'
                theme_text_color: "Custom"
                text_color: 0, 0, 0, 1
            MDRoundFlatButton:
                text: "update"
                on_press:
                    root.show_password_update_dialog()

    Label:
        size_hint: 1, 0.3

    Footer:
